# TelePost Scheduler Bot

Приложение для планирования и автоматической отправки сообщений в Telegram-каналы.

## Возможности

- Планирование постов с указанием времени публикации
- Прикрепление одного или нескольких изображений к постам
- Мониторинг статуса отправки (запланировано, отправлено, ошибка)
- Календарная визуализация запланированных постов
- Единый бот для всех пользователей сервиса
- Возможность указания отдельного чата для каждого поста
- Генерация контента с помощью AI (xAI интеграция)
- Предпросмотр сообщений в стиле Telegram
- Аутентификация пользователей через Supabase Auth

## Технологии

- **Frontend**: React 18, TypeScript, Vite
- **UI компоненты**: shadcn/ui, Tailwind CSS, Radix UI
- **Хранение данных**: Supabase (PostgreSQL)
- **Аутентификация**: Supabase Auth
- **Роутинг**: React Router
- **Форматирование дат**: date-fns
- **Управление состоянием**: React Query
- **Серверные функции**: Vercel API Routes и Cron Jobs
- **Валидация форм**: React Hook Form, Zod
- **Визуализация данных**: Recharts

## Установка

```sh
# Клонирование репозитория
git clone https://github.com/yourusername/telepost-scheduler-bot.git
cd telepost-scheduler-bot

# Установка зависимостей
npm install

# Создание файла .env для конфигурации
cp .env.example .env
# Отредактируйте файл .env, указав необходимые токены и URL

# Локальный запуск
npm run dev
```

## Настройка окружения

Создайте файл `.env` со следующими переменными:

```
# Telegram Bot Configuration
VITE_TELEGRAM_BOT_TOKEN=your_telegram_bot_token

# Supabase Configuration
VITE_SUPABASE_URL=your_supabase_url
VITE_SUPABASE_ANON_KEY=your_supabase_anon_key
SERVICE_ROLE_KEY=your_service_role_key

# Vercel Cron Jobs
CRON_SECRET=your_cron_secret_key

# xAI API (опционально)
XAI_API_KEY=your_xai_api_key
```

## Настройка Telegram-бота

1. Создайте нового бота через [@BotFather](https://t.me/BotFather)
2. Получите токен бота и добавьте его в файл `.env`
3. Добавьте бота администратором в ваш канал
4. Дайте боту права на публикацию сообщений
5. В приложении укажите ID вашего канала в настройках профиля

## Структура базы данных

Приложение использует следующие таблицы в Supabase:

### Таблица `posts`
- `id`: UUID - уникальный идентификатор поста
- `content`: String - текст сообщения
- `image_url`: String (опционально) - URL изображения (устаревшее)
- `image_urls`: String[] (опционально) - массив URL изображений
- `scheduled_time`: Timestamp - запланированное время отправки
- `status`: String ('scheduled', 'sent', 'failed') - статус отправки
- `chat_ids`: String[] - ID каналов для отправки
- `user_id`: UUID - ID пользователя, создавшего пост
- `created_at`: Timestamp - время создания
- `updated_at`: Timestamp - время обновления

### Таблица `bot_configs`
- `id`: UUID - уникальный идентификатор конфигурации
- `token`: String - токен бота (опционально)
- `chat_ids`: String[] - массив ID каналов
- `user_id`: UUID - ID пользователя
- `created_at`: Timestamp - время создания
- `updated_at`: Timestamp - время обновления

## Структура проекта

```
src/
├── components/         # Компоненты React
│   ├── ui/             # UI компоненты shadcn
│   ├── layout/         # Компоненты макета
│   ├── dashboard/      # Компоненты дашборда
│   ├── auth/           # Компоненты аутентификации
│   ├── calendar/       # Календарные компоненты
│   ├── BotSettings     # Настройка бота
│   ├── PostEditor      # Редактор постов
│   ├── ScheduledPosts  # Список постов
│   └── TelegramPreview # Предпросмотр сообщений
├── hooks/              # React хуки
├── integrations/       # Интеграции с внешними API
│   ├── supabase/       # Клиент Supabase
│   └── xai/            # Интеграция с xAI
├── lib/                # Вспомогательные функции
│   └── auth/           # Аутентификация
├── pages/              # Страницы приложения
│   ├── Index           # Главная страница (дашборд)
│   ├── Auth            # Страница аутентификации
│   ├── Profile         # Страница профиля
│   ├── Promo           # Промо-страница
│   └── NotFound        # Страница 404
└── App.tsx             # Корневой компонент
api/
└── send-scheduled-posts.js # API-эндпоинт для отправки запланированных постов
```

## Функциональность

### Планирование постов
- Создание постов с текстом и изображениями
- Планирование времени отправки
- Выбор канала для отправки
- Предпросмотр в стиле Telegram

### Управление постами
- Просмотр запланированных постов
- Редактирование и удаление постов
- Фильтрация по статусу
- Календарный вид расписания

### Отправка сообщений
- Автоматическая отправка в запланированное время через Vercel Cron Jobs
- Поддержка текстовых сообщений
- Поддержка одиночных изображений
- Поддержка групп изображений (медиагрупп)

### Аутентификация
- Регистрация и вход через Supabase Auth
- Защищенные маршруты
- Управление профилем пользователя

## Автоматическая отправка постов

Для автоматической отправки запланированных постов используется:
1. API-эндпоинт `/api/send-scheduled-posts`
2. Vercel Cron Jobs или внешний сервис cron-job.org

Подробная информация о настройке автоматической отправки постов находится в [README-CRON.md](README-CRON.md).

## Разработка

```sh
# Запуск в режиме разработки
npm run dev

# Сборка проекта
npm run build

# Сборка для разработки
npm run build:dev

# Предпросмотр собранного проекта
npm run preview

# Ручной запуск отправки запланированных постов
npm run send-posts
```

## Лицензия

MIT
