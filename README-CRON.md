# Настройка Vercel Cron Jobs для автоматической отправки постов

Для автоматической отправки запланированных постов используется встроенная функциональность Vercel Cron Jobs. Это позволяет запускать API-эндпоинт по расписанию без необходимости в дополнительных серверах или внешних сервисах.

## Как это работает

1. API-эндпоинт `/api/send-scheduled-posts` проверяет базу данных на наличие постов со статусом "scheduled", время отправки которых уже наступило.
2. Для каждого найденного поста:
   - Отправляет сообщение в указанные Telegram-каналы
   - Обновляет статус поста на "sent" при успешной отправке или "failed" при ошибке

## Настройка

### 1. Конфигурация в vercel.json

```json
"crons": [
  {
    "path": "/api/send-scheduled-posts",
    "schedule": "* * * * *"
  }
]
```

Расписание "* * * * *" означает запуск каждую минуту.

### 2. Безопасность

Для защиты API-эндпоинта от несанкционированного доступа используется переменная окружения `CRON_SECRET`. Vercel автоматически добавляет этот секрет в заголовок Authorization при выполнении cron-задачи.

1. Добавьте переменную окружения в проект на Vercel:
   - Перейдите в настройки проекта на Vercel
   - Добавьте переменную `CRON_SECRET` с уникальным значением
   
2. Для локального тестирования:
   - Добавьте `CRON_SECRET` в ваш локальный файл `.env`
   - При тестировании API используйте заголовок `Authorization: Bearer ваш_секретный_ключ`

## Ручной запуск

Если вам нужно запустить отправку постов вручную, используйте команду:

```bash
npm run send-posts
```

Или отправьте GET-запрос к эндпоинту с правильным заголовком авторизации:

```bash
curl -X GET -H "Authorization: Bearer ваш_секретный_ключ" https://telexa.vercel.app/api/send-scheduled-posts
```

## Мониторинг

Логи выполнения cron-задач можно просмотреть в разделе "Functions" на панели управления Vercel. Там вы увидите все запуски, успешные и неудачные, а также подробные логи каждого запуска. 