# Планировщик отправки постов в Telegram с Vercel Cron Jobs

Этот планировщик использует Vercel Cron Jobs для отправки запланированных постов в Telegram.

## Преимущества

1. **Простота** - встроенная функция Vercel без дополнительных серверов
2. **Надежность** - инфраструктура Vercel обеспечивает стабильную работу
3. **Бесплатно** - входит в бесплатный план Vercel (до 1000 выполнений в месяц)
4. **Интеграция** - всё в одном месте с вашим основным приложением

## Как это работает

1. Vercel Cron Jobs запускает API-эндпоинт `/api/send-scheduled-posts` по расписанию
2. Эндпоинт проверяет базу данных Supabase на наличие запланированных постов
3. Отправляет посты через Telegram API и обновляет их статус в базе данных

## Настройка

1. **Переменные окружения**

   Убедитесь, что в настройках проекта Vercel установлены следующие переменные окружения:
   
   ```
   VITE_SUPABASE_URL=https://bqysahcurgznnigptlqf.supabase.co
   VITE_SUPABASE_ANON_KEY=ваш_ключ
   VITE_TELEGRAM_BOT_TOKEN=ваш_токен_бота
   SERVICE_ROLE_KEY=ваш_сервисный_ключ
   API_SECRET=секретный_ключ_для_защиты_API (опционально)
   ```

2. **Конфигурация Cron Jobs**

   В файле `vercel.json` уже настроено расписание:
   
   ```json
   "crons": {
     "send-scheduled-posts": {
       "path": "/api/send-scheduled-posts",
       "schedule": "* * * * *"
     }
   }
   ```
   
   Расписание `* * * * *` означает выполнение каждую минуту. Вы можете изменить его по своему усмотрению:
   
   - `*/5 * * * *` - каждые 5 минут
   - `0 * * * *` - каждый час (в начале часа)
   - `0 0 * * *` - каждый день в полночь (UTC)

## Мониторинг и отладка

1. **Логи Vercel**
   
   Вы можете просматривать логи выполнения в панели управления Vercel:
   - Перейдите в ваш проект на Vercel
   - Выберите вкладку "Functions"
   - Найдите функцию `/api/send-scheduled-posts`
   - Просмотрите логи выполнения

2. **Ручной запуск**

   Вы можете вручную запустить отправку постов, обратившись к эндпоинту:
   
   ```
   curl https://ваш-домен.vercel.app/api/send-scheduled-posts
   ```
   
   Если вы настроили API_SECRET, добавьте заголовок авторизации:
   
   ```
   curl -H "Authorization: Bearer ваш_секретный_ключ" https://ваш-домен.vercel.app/api/send-scheduled-posts
   ```

## Управление Cron Jobs в Vercel

1. **Включение/отключение**
   
   Вы можете временно отключить все cron-задачи в настройках проекта Vercel:
   - Перейдите в ваш проект на Vercel
   - Выберите вкладку "Settings"
   - Перейдите в раздел "Cron Jobs"
   - Используйте переключатель для включения/отключения

2. **Изменение расписания**
   
   Для изменения расписания отредактируйте файл `vercel.json` и выполните новый деплой.

## Миграция с Edge Functions

1. Вы можете отключить Edge Functions в консоли Supabase
2. Или оставить оба решения работающими параллельно для плавной миграции

## Ограничения

- Бесплатный план Vercel включает до 1000 выполнений Cron Jobs в месяц
- Максимальное время выполнения функции - 10 секунд (Hobby план) или 60 секунд (Pro план)
- Если у вас много постов для отправки, учитывайте лимиты времени выполнения 